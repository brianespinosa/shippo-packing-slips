name: Release

on:
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'package.json'
      - 'yarn.lock'
      - 'tsconfig.json'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Setup
        uses: ./.github/actions/setup
      - name: Build bundle
        run: yarn build:bundle
      - name: Publish release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: latest
          make_latest: true
          # Inter font files (Inter-Regular.ttf, Inter-Bold.ttf) are intentionally
          # excluded â€” they are sourced directly from rsms/inter during Pi provisioning.
          files: |
            dist/bundle/index.js
            dist/bundle/*.afm
            dist/bundle/sRGB_IEC61966_2_1.icc
